<app-header></app-header>
<div class="container my-5">
  <div class="row g-4">
    <!-- ==== LEFT: RECEIVER INFO ==== -->
    <div class="col-lg-6">
     <div class="card shadow-sm border-0 sticky-order">

        <div class="card-body">
          <h5 class="fw-bold mb-3">Thông tin người nhận</h5>

          <form [formGroup]="orderForm">
            <div class="mb-3">
              <label class="form-label">Họ và tên</label>
              <input
                type="text"
                class="form-control"
                placeholder="Nhập họ và tên"
                formControlName="fullname"
                [class.is-invalid]="
                  orderForm.get('fullname')!.invalid &&
                  orderForm.get('fullname')!.touched
                "
              />
              <div
                *ngIf="
                  orderForm.get('fullname')!.invalid &&
                  orderForm.get('fullname')!.touched
                "
                class="invalid-feedback"
              >
                Họ và tên là trường bắt buộc.
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-control"
                placeholder="Nhập email"
                formControlName="email"
                [class.is-invalid]="
                  orderForm.get('email')!.invalid &&
                  orderForm.get('email')!.touched
                "
              />
              <div
                *ngIf="
                  orderForm.get('email')!.invalid &&
                  orderForm.get('email')!.touched
                "
                class="invalid-feedback"
              >
                {{
                  orderForm.get("email")!.hasError("email")
                    ? "Email không hợp lệ"
                    : "Email là trường bắt buộc"
                }}
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Số điện thoại</label>
              <input
                type="text"
                class="form-control"
                placeholder="Nhập số điện thoại"
                formControlName="phone_number"
                [class.is-invalid]="
                  orderForm.get('phone_number')!.invalid &&
                  orderForm.get('phone_number')!.touched
                "
              />
              <div
                *ngIf="
                  orderForm.get('phone_number')!.invalid &&
                  orderForm.get('phone_number')!.touched
                "
                class="invalid-feedback"
              >
                Số điện thoại là trường bắt buộc và ít nhất 6 ký tự.
              </div>
            </div>
            <div class="mb-3">
              <label for="address" class="form-label">Địa chỉ</label>
              <input
                type="text"
                class="form-control"
                formControlName="address"
                placeholder="Địa chỉ"
                required
                id="address"
                [class.is-invalid]="
                  orderForm.get('address')!.invalid &&
                  orderForm.get('address')!.touched
                "
              />
              <div
                *ngIf="
                  orderForm.get('address')!.invalid &&
                  orderForm.get('address')!.touched
                "
                class="invalid-feedback"
              >
                Địa chỉ là trường bắt buộc và ít nhất 5 ký tự.
              </div>
            </div>
            <div class="mb-3">
              <label for="note" class="form-label">Ghi chú</label>
              <input
                type="text"
                class="form-control"
                formControlName="note"
                placeholder="Ghi chú"
                required
                id="note"
              />
            </div>
            <div class="mb-3">
              <label for="shippingMethod">Phương thức vận chuyển</label>
              <select
                class="form-control"
                id="shippingMethod"
                formControlName="shipping_method"
              >
                <option value="express">Nhanh (Express)</option>
                <option value="normal">Thường (Normal)</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="paymentMethod">Phương thức thanh toán</label>
              <select
                class="form-control"
                id="paymentMethod"
                formControlName="payment_method"
              >
                <option value="cod">Thanh toán khi nhận hàng (COD)</option>
                <option value="other">Thanh toán khác</option>
              </select>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- ==== RIGHT: ORDER ITEMS + TOTAL + COUPON + ORDER BUTTON ==== -->
    <div class="col-lg-6">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="fw-bold mb-3">Sản phẩm đã đặt</h5>

          <!-- Product Item -->
          <ng-container *ngFor="let item of cartItems">
            <div class="order-item">
              <img [src]="item.product.thumbnail" class="order-thumb" />

              <div class="order-info">
                <div class="order-title">
                  {{ item.product.name }}
                </div>

                <div class="order-price">
                  {{ item.product.price | number: "1.0-0" }} đ
                </div>

                <div class="qty-control">
                  <button
                    class="qty-btn"
                    [disabled]="item.quantity === 1"
                    (click)="decreaseQuantity(item.product.id)"
                  >
                    −
                  </button>

                  <span class="qty-number">
                    {{ item.quantity }}
                  </span>

                  <button
                    class="qty-btn"
                    (click)="increaseQuantity(item.product.id)"
                  >
                    +
                  </button>
                </div>
              </div>

              <div class="order-total">
                <div class="total-money">
                  {{ item.product.price * item.quantity | number: "1.0-0" }} đ
                </div>

                <button
                  class="remove-btn"
                  (click)="removeItem(item.product.id)"
                >
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </div>
          </ng-container>

          <!-- Total -->
          <div class="order-summary">
            <div class="summary-row">
              <span>Tạm tính</span>
              <span>{{ totalAmount | number: "1.0-0" }} đ</span>
            </div>

            <div class="summary-row">
              <span>Phí vận chuyển</span>
              <span class="text-success">Miễn phí</span>
            </div>

            <div class="summary-row total-row">
              <span>Tổng thanh toán</span>
              <span>{{ totalAmount | number: "1.0-0" }} đ</span>
            </div>
          </div>

          <!-- Coupon -->
          <div class="mb-3">
            <label class="form-label">Mã giảm giá</label>
            <div class="input-group">
              <input
                type="text"
                class="form-control"
                placeholder="Nhập mã giảm giá"
              />
              <button class="btn btn-outline-primary">Áp dụng</button>
            </div>
          </div>

          <!-- Order Button -->
         <button
  class="checkout-btn"
  (click)="placeOrder()"
>
  Thanh toán ngay
</button>

        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>
